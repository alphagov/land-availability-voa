language: python
python:
- '3.5'
install: pip install -r requirements.txt
services:
- postgresql
before_script:
- psql -c 'create database landavailability_test;' -U postgres
- cd landavailability
env:
  global:
  - DATABASE_URL=postgres://postgres@localhost:5432/landavailability_test
  - SECRET_KEY=abcd1234
script: pytest -v
deploy:
  provider: heroku
  api_key:
    secure: "bqi/I9soZI7ypgfMo349anpgG6f8xQWX+VX5pmNd3FAS0w7M10n1+OLpOgEX0lk24oSwGS9uVs0zWkwCYeE5ZlAwhSo28yCEI0ilNruJ6XZSkEvqn2vlFng19Zb4ZYe3c+d6WziUd//ffZ6tBiJqRIN917DWQxiaBLda/27IM4wpQHlfpoQtniAVydsbBErYyFqX7gGBkYjZetQZztV6sOZdu5GJPZ9CNlYsbhatE1VRhFj8TndFFkyZZKAh1X5NuVhaRkTBvmf0xshH/nX1D7pn7jS7VtWSzvQrYYGgvAA+poD0fN+u1oPCtwhd6TOquNKiK4a4elpF9bTOMEQoIHkXqxfN7xYnK1syCHRFIjsWPFke8qNTBorV1GQm9gKI+E32XvObpzpBGt4b+X7lHV/IN3kA+SeLFpBz+R0Q07BB73OvWOgNCqZVzMU1pCpfl2KN+l3F06xi766sA9FjyWvPe5AQFm4vw2/SMvQyF09qEj1nWGw4ey69JFFKKH7sSpy9Cq8YVgZjQxIrcz6Y0ctnkpz7qM7BAOvR6U6ZUUtwXHkekrDQBjqMezSJSaFYOLqdte0si4hSSGq4bYduaWksJGiqLMOUgMMo6N+OX7QOCowWO9aBwbHPv3luFqq2ANlqn0IFi4sNWYgk5hzQ3SX7mc37PnbniTBbd6o1V9g="
  strategy: git
  app: land-availability-voa
  on:
    repo: alphagov/land-availability-voa
  run:
    - "python landavailability/manage.py migrate"
